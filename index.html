<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì •í•˜ê¸° ê²Œì„</title>
<style>
body {margin:0;font-family:"Pretendard","Noto Sans KR",sans-serif;background:#fff;color:#000;text-align:center;}
header {padding:20px;background:#f0f0f0;border-bottom:3px solid #000;font-size:28px;font-weight:bold;}
.page {display:none;padding:20px;}
.active {display:block;}
h2 {margin:15px 0;}

/* ë²„íŠ¼ */
.menu-btn {width:80%;max-width:280px;padding:15px;margin:15px auto;border:none;border-radius:12px;font-size:20px;background:#000;color:white;cursor:pointer;display:block;transition:0.25s;}
.menu-btn:hover {background:#333;transform:scale(1.05);}
.back-btn {margin-top:20px;padding:10px 25px;font-size:16px;background:#555;border:none;border-radius:8px;color:white;cursor:pointer;}

/* ì…ë ¥ì°½ */
.name-input {margin:8px;padding:10px;width:70%;max-width:250px;border-radius:8px;border:1px solid #000;font-size:16px;}

/* ë£°ë › */
.roulette-container {margin:30px auto;width:90%;max-width:300px;height:300px;position:relative;}
#rouletteCanvas {width:100%;height:100%;}
.pointer {width:0;height:0;border-left:25px solid transparent;border-right:25px solid transparent;border-top:50px solid red;position:absolute;bottom:-50px;left:calc(50% - 25px);}

/* ì‚¬ë‹¤ë¦¬ */
.ladder-container {margin:20px auto;width:95%;max-width:800px;height:450px;background:#ddd;border-radius:10px;overflow:hidden;position:relative;}
canvas {background:#eee;}
</style>
</head>
<body>

<header>ì •í•˜ê¸° ê²Œì„</header>

<!-- ë©”ì¸ -->
<div id="main" class="page active">
  <h2>ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”</h2>
  <button class="menu-btn" onclick="showPage('roulette')">ğŸ¡ ë£°ë › ì •í•˜ê¸°</button>
  <button class="menu-btn" onclick="showPage('ladder')">ğŸ¢ ì‚¬ë‹¤ë¦¬ íƒ€ê¸°</button>
</div>

<!-- ë£°ë › -->
<div id="roulette" class="page">
  <h2>ğŸ¡ ë£°ë › ì •í•˜ê¸°</h2>
  <input class="name-input" id="r1" placeholder="ì´ë¦„ 1">
  <input class="name-input" id="r2" placeholder="ì´ë¦„ 2">
  <input class="name-input" id="r3" placeholder="ì´ë¦„ 3 (ì„ íƒ)">
  <input class="name-input" id="r4" placeholder="ì´ë¦„ 4 (ì„ íƒ)">
  <input class="name-input" id="r5" placeholder="ì´ë¦„ 5 (ì„ íƒ)">
  <br>
  <button class="menu-btn" onclick="spinRoulette()">ğŸ¯ ëŒë¦¬ê¸°</button>
  <div class="roulette-container">
    <canvas id="rouletteCanvas" width="300" height="300"></canvas>
    <div class="pointer"></div>
  </div>
  <div id="rouletteResult"></div>
  <button class="back-btn" onclick="showPage('main')">â¬… ë©”ì¸ìœ¼ë¡œ</button>
</div>

<!-- ì‚¬ë‹¤ë¦¬ -->
<div id="ladder" class="page">
  <h2>ğŸ¢ ì‚¬ë‹¤ë¦¬ íƒ€ê¸°</h2>
  <input class="name-input" id="l1" placeholder="ì´ë¦„ 1">
  <input class="name-input" id="l2" placeholder="ì´ë¦„ 2">
  <input class="name-input" id="l3" placeholder="ì´ë¦„ 3 (ì„ íƒ)">
  <input class="name-input" id="l4" placeholder="ì´ë¦„ 4 (ì„ íƒ)">
  <input class="name-input" id="l5" placeholder="ì´ë¦„ 5 (ì„ íƒ)">
  <br>
  <button id="startLadderBtn" class="menu-btn" onclick="startLadder()">ê²Œì„ ì‹œì‘</button>
  <div class="ladder-container">
    <canvas id="ladderCanvas" width="800" height="450"></canvas>
  </div>
  <div id="ladderResult"></div>
  <button id="ladderBackBtn" class="back-btn" onclick="showPage('main')">â¬… ë©”ì¸ìœ¼ë¡œ</button>
</div>

<script>
// ---------------- í˜ì´ì§€ ì „í™˜ ----------------
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ---------------- ë£°ë › ----------------
const rColors=["#27ae60","#c0392b","#f1c40f","#2980b9","#e67e22"];
let rAngle=0;
function drawRoulette(names){
  const c=document.getElementById("rouletteCanvas");
  const ctx=c.getContext("2d");
  const len=names.length;
  const arc=(2*Math.PI)/len;
  ctx.clearRect(0,0,c.width,c.height);
  for(let i=0;i<len;i++){
    ctx.beginPath();
    ctx.fillStyle=rColors[i];
    ctx.moveTo(c.width/2,c.height/2);
    ctx.arc(c.width/2,c.height/2,c.width/2,arc*i,arc*(i+1));
    ctx.fill();
    ctx.save();
    ctx.translate(c.width/2,c.height/2);
    ctx.rotate(arc*(i+0.5));
    ctx.fillStyle="#000";
    ctx.font="16px Pretendard";
    ctx.fillText(names[i],c.width/4,5);
    ctx.restore();
  }
}
function spinRoulette(){
  let names=[r1.value.trim(),r2.value.trim(),r3.value.trim(),r4.value.trim(),r5.value.trim()].filter(n=>n);
  if(names.length<2){alert("ìµœì†Œ 2ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");return;}
  drawRoulette(names);
  const len = names.length;
  const totalRot = 360*6 + Math.random()*360;
  const duration = 4000;
  const startTime = performance.now();
  function animate(time){
    let t = time - startTime;
    if(t>duration) t=duration;
    const ease = 1 - Math.pow(1-t/duration,3);
    rAngle = totalRot * ease;
    document.getElementById("rouletteCanvas").style.transform=`rotate(${rAngle}deg)`;
    if(t<duration) requestAnimationFrame(animate);
    else showRouletteWinner(names);
  }
  requestAnimationFrame(animate);
}
function showRouletteWinner(names){
  const len = names.length;
  const arcDeg = 360 / len;
  const rotated = rAngle % 360;
  const index = Math.floor((360 - rotated + arcDeg/2) % 360 / arcDeg);
  document.getElementById("rouletteResult").innerHTML=`<h2>ğŸ‰ ê²°ê³¼: ${names[index]}</h2>`;
}

// ---------------- ì‚¬ë‹¤ë¦¬ ----------------
const lcanvas=document.getElementById("ladderCanvas");
const lctx=lcanvas.getContext("2d");
let ladder=[];
let ladderNames=[];
let animationInProgress=false;

function startLadder(){
  if(animationInProgress) return;
  ladderNames=[l1.value.trim(),l2.value.trim(),l3.value.trim(),l4.value.trim(),l5.value.trim()].filter(n=>n);
  if(ladderNames.length<2){alert("ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥!"); return;}
  if(ladderNames.length>5){alert("ìµœëŒ€ 5ëª…ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return;}
  animationInProgress=true;
  document.getElementById("startLadderBtn").disabled=true;
  document.getElementById("ladderBackBtn").disabled=true;
  generateLadder(ladderNames.length);
  drawLadder(true);
  runAllAnimations();
}

function generateLadder(count){
  ladder=[];
  for(let i=0;i<count;i++) ladder.push({x:lcanvas.width/(count+1)*(i+1),bars:[]});
  for(let i=0;i<count-1;i++){
    const barCount = 1 + Math.floor(Math.random()*2);
    for(let j=0;j<barCount;j++){
      const y=Math.random()*(lcanvas.height-60)+30;
      ladder[i].bars.push({y});
    }
  }
}

function drawLadder(hidden=false, people=[]){
  lctx.clearRect(0,0,lcanvas.width,lcanvas.height);
  lctx.fillStyle=hidden?"#bbb":"#eee";
  lctx.fillRect(0,0,lcanvas.width,lcanvas.height);
  lctx.strokeStyle="#000"; lctx.lineWidth=3;
  ladder.forEach(l=>{
    lctx.beginPath(); lctx.moveTo(l.x,20); lctx.lineTo(l.x,lcanvas.height-20); lctx.stroke();
  });
  ladder.forEach((l,i)=>{
    if(i>=ladder.length-1) return;
    l.bars.forEach(b=>{
      lctx.beginPath(); lctx.moveTo(l.x,b.y); lctx.lineTo(ladder[i+1].x,b.y); lctx.stroke();
    });
  });
  ladderNames.forEach((n,i)=>{
    const px=ladder[i].x;
    lctx.fillStyle="#000"; lctx.font="16px Pretendard"; lctx.fillText(n,px-20,18);
  });
  people.forEach(p=>{
    lctx.fillStyle="#f00"; lctx.beginPath(); lctx.arc(p.x,p.y,10,0,Math.PI*2); lctx.fill();
    lctx.fillStyle="#000"; lctx.fillText(p.name,p.x-15,p.y-15);
  });
}

function runAllAnimations(){
  let index=0;
  const results=[];
  function next(){
    if(index>=ladderNames.length){showLadderResult(results); return;}
    animatePerson(index,finalIndex=>{
      results.push({name:ladderNames[index],pos:finalIndex});
      index++; setTimeout(next,200);
    });
  }
  next();
}

function animatePerson(idx,done){
  let x=ladder[idx].x; let y=20;
  const person={x,y,name:ladderNames[idx]};
  const speedX = 0.1;
  function step(){
    let targetX = x;
    for(let j=0;j<ladder.length-1;j++){
      ladder[j].bars.forEach(b=>{
        if(Math.abs(y-b.y)<3){
          if(Math.random()<0.4) targetX = ladder[j+1].x;
        }
      });
    }
    x += (targetX - x) * speedX;
    person.x = x; person.y = y;
    drawLadder(false,[person]);
    y+=2;
    if(y<lcanvas.height-20) requestAnimationFrame(step);
    else{
      const finalIndex = idx===0?0:Math.floor(Math.random()*(ladder.length-1))+1;
      done(finalIndex+1);
      if(idx===ladderNames.length-1){
        animationInProgress=false;
        document.getElementById("startLadderBtn").disabled=false;
        document.getElementById("ladderBackBtn").disabled=false;
      }
    }
  }
  step();
}

function showLadderResult(results){
  let html="<h2>ğŸ‰ ì‚¬ë‹¤ë¦¬ ê²°ê³¼</h2>";
  results.forEach((r,i)=>{
    html += (i===0)?`ğŸ ë‹¹ì²¨ â†’ ${r.name}<br>`:`âŒ ê½<br>`;
  });
  document.getElementById("ladderResult").innerHTML=html;
}
</script>
</body>
</html>

