<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì •í•˜ê¸° ê²Œì„</title>
<style>
/* ------------------- ê¸°ë³¸ ìŠ¤íƒ€ì¼ ------------------- */
body {margin:0;font-family:"Pretendard","Noto Sans KR",sans-serif;background:#0d0d0d;color:#fff;text-align:center;}
header {padding:20px;background:#1a1a1a;border-bottom:3px solid #ff7b00;font-size:28px;font-weight:bold;}
.page {display:none;padding:20px;}
.active {display:block;}
h2 {margin:15px 0;}

/* ------------------- ë²„íŠ¼ ------------------- */
.menu-btn {width:80%;max-width:280px;padding:15px;margin:15px auto;border:none;border-radius:12px;font-size:20px;background:#ff7b00;color:white;cursor:pointer;display:block;transition:0.25s;}
.menu-btn:hover {background:#ffa64c;transform:scale(1.05);}
.back-btn {margin-top:20px;padding:10px 25px;font-size:16px;background:#555;border:none;border-radius:8px;color:white;cursor:pointer;}

/* ------------------- ì…ë ¥ì°½ ------------------- */
.name-input {margin:8px;padding:10px;width:70%;max-width:250px;border-radius:8px;border:none;font-size:16px;}

/* ------------------- ë£°ë › ------------------- */
.roulette-container {margin:30px auto;width:90%;max-width:300px;height:300px;position:relative;}
#rouletteCanvas {width:100%;height:100%;}
.pointer {
  width:0;height:0;
  border-left:25px solid transparent;
  border-right:25px solid transparent;
  border-bottom:50px solid red; /* í•€ ë†’ì´ ì—… */
  position:absolute;
  top:-25px; /* ìº”ë²„ìŠ¤ ìœ„ë¡œ ì˜¬ë¼ê°€ë„ë¡ */
  left:calc(50% - 25px);
}

/* ------------------- ì‚¬ë‹¤ë¦¬ ------------------- */
.ladder-container {margin:20px auto;width:95%;max-width:800px;height:450px;background:#111;border-radius:10px;overflow:hidden;}
canvas {background:#111;}
</style>
</head>
<body>

<header>ì •í•˜ê¸° ê²Œì„</header>

<!-- ë©”ì¸ í˜ì´ì§€ -->
<div id="main" class="page active">
  <h2>ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”</h2>
  <button class="menu-btn" onclick="showPage('roulette')">ğŸ¡ ë£°ë › ì •í•˜ê¸°</button>
  <button class="menu-btn" onclick="showPage('ladder')">ğŸ¢ ì‚¬ë‹¤ë¦¬ íƒ€ê¸°</button>
</div>

<!-- ë£°ë › í˜ì´ì§€ -->
<div id="roulette" class="page">
  <h2>ğŸ¡ ë£°ë › ì •í•˜ê¸°</h2>
  <input class="name-input" id="r1" placeholder="ì´ë¦„ 1">
  <input class="name-input" id="r2" placeholder="ì´ë¦„ 2">
  <input class="name-input" id="r3" placeholder="ì´ë¦„ 3 (ì„ íƒ)">
  <input class="name-input" id="r4" placeholder="ì´ë¦„ 4 (ì„ íƒ)">
  <input class="name-input" id="r5" placeholder="ì´ë¦„ 5 (ì„ íƒ)">
  <br>
  <button class="menu-btn" onclick="spinRoulette()">ğŸ¯ ëŒë¦¬ê¸°</button>
  <div class="roulette-container">
    <div class="pointer"></div>
    <canvas id="rouletteCanvas" width="300" height="300"></canvas>
  </div>
  <div id="rouletteResult"></div>
  <button class="back-btn" onclick="showPage('main')">â¬… ë©”ì¸ìœ¼ë¡œ</button>
</div>

<!-- ì‚¬ë‹¤ë¦¬ íƒ€ê¸° í˜ì´ì§€ -->
<div id="ladder" class="page">
  <h2>ğŸ¢ ì‚¬ë‹¤ë¦¬ íƒ€ê¸°</h2>
  <input class="name-input" id="l1" placeholder="ì´ë¦„ 1">
  <input class="name-input" id="l2" placeholder="ì´ë¦„ 2">
  <input class="name-input" id="l3" placeholder="ì´ë¦„ 3 (ì„ íƒ)">
  <input class="name-input" id="l4" placeholder="ì´ë¦„ 4 (ì„ íƒ)">
  <input class="name-input" id="l5" placeholder="ì´ë¦„ 5 (ì„ íƒ)">
  <br>
  <button class="menu-btn" onclick="startLadder()">ê²Œì„ ì‹œì‘</button>
  <div class="ladder-container">
    <canvas id="ladderCanvas" width="800" height="450"></canvas>
  </div>
  <div id="ladderResult"></div>
  <button class="back-btn" onclick="showPage('main')">â¬… ë©”ì¸ìœ¼ë¡œ</button>
</div>

<script>
/* ------------------- í˜ì´ì§€ ì „í™˜ ------------------- */
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ------------------- ë£°ë › ------------------- */
const colors=["#27ae60","#c0392b","#f1c40f","#2980b9","#e67e22"];
let angle=0;
function drawRoulette(names){
  const canvas=document.getElementById("rouletteCanvas");
  const ctx=canvas.getContext("2d");
  const len=names.length;
  const arc=(2*Math.PI)/len;
  ctx.clearRect(0,0,300,300);
  for(let i=0;i<len;i++){
    ctx.beginPath();
    ctx.fillStyle=colors[i];
    ctx.moveTo(150,150);
    ctx.arc(150,150,150,arc*i,arc*(i+1));
    ctx.fill();
    ctx.save();
    ctx.translate(150,150);
    ctx.rotate(arc*(i+0.5));
    ctx.fillStyle="#000";
    ctx.font="16px Pretendard";
    ctx.fillText(names[i],60,5);
    ctx.restore();
  }
}
function spinRoulette(){
  let names=[r1.value.trim(),r2.value.trim(),r3.value.trim(),r4.value.trim(),r5.value.trim()].filter(n=>n);
  if(names.length<2){alert("ìµœì†Œ 2ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");return;}
  drawRoulette(names);
  const spinTime=Math.random()*2000+3000;
  const randomSpin=Math.random()*360;
  const start=angle;
  const end=angle+360*8+randomSpin;
  const startTime=performance.now();
  function animate(time){
    const t=time-startTime;
    if(t<spinTime){
      angle=-easeOut(t,start,end-start,spinTime);
      document.getElementById("rouletteCanvas").style.transform=`rotate(${angle}deg)`;
      requestAnimationFrame(animate);
    }else{
      angle=-end;
      document.getElementById("rouletteCanvas").style.transform=`rotate(${angle}deg)`;
      showRouletteWinner(names);
    }
  }
  requestAnimationFrame(animate);
}
function easeOut(t,b,c,d){t/=d;return -c*t*(t-2)+b;}
function showRouletteWinner(names){
  const arc=360/names.length;
  const fixed=(angle%360+360)%360;
  const idx=Math.floor((360-fixed)/arc);
  document.getElementById("rouletteResult").innerHTML=`<h2>ğŸ‰ ê²°ê³¼: ${names[idx]}</h2>`;
}

/* ------------------- ì‚¬ë‹¤ë¦¬ ------------------- */
const lcanvas=document.getElementById("ladderCanvas");
const lctx=lcanvas.getContext("2d");
let ladder=[];
let ladderNames=[];
function startLadder(){
  ladderNames=[l1.value.trim(),l2.value.trim(),l3.value.trim(),l4.value.trim(),l5.value.trim()].filter(n=>n);
  if(ladderNames.length<2){alert("ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");return;}
  if(ladderNames.length>5){alert("ìµœëŒ€ 5ëª…ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");return;}
  drawLadder(ladderNames.length);
  runAllAnimations();
}
function drawLadder(count){
  lctx.clearRect(0,0,lcanvas.width,lcanvas.height);
  const spacing=lcanvas.width/(count+1);
  ladder=[];
  for(let i=0;i<count;i++){
    const x=spacing*(i+1);
    ladder.push({x,bars:[]});
    lctx.strokeStyle="#fff";lctx.lineWidth=3;lctx.beginPath();lctx.moveTo(x,20);lctx.lineTo(x,lcanvas.height-20);lctx.stroke();
  }
  for(let i=0;i<count-1;i++){
    const barCount=Math.floor(Math.random()*4)+2;
    for(let j=0;j<barCount;j++){
      const y=Math.random()*(lcanvas.height-60)+30;
      ladder[i].bars.push({y});
      lctx.strokeStyle="#ff7b00";lctx.lineWidth=3;lctx.beginPath();lctx.moveTo(ladder[i].x,y);lctx.lineTo(ladder[i+1].x,y);lctx.stroke();
    }
  }
  lctx.fillStyle="#ffdd96";lctx.font="18px Pretendard";
  for(let i=0;i<count;i++){lctx.fillText(ladderNames[i],ladder[i].x-20,18);}
}
function runAllAnimations(){
  let index=0;
  const results=[];
  function next(){
    if(index>=ladderNames.length){showLadderResult(results);return;}
    animatePerson(index,finalPos=>{results.push({name:ladderNames[index],pos:finalPos});index++;setTimeout(next,300);});
  }
  next();
}
function animatePerson(idx,done){
  let x=ladder[idx].x;let y=20;
  function step(){
    lctx.clearRect(0,0,lcanvas.width,lcanvas.height);drawLadder(ladderNames.length);
    lctx.fillStyle="#ff4444";lctx.beginPath();lctx.arc(x,y,10,0,Math.PI*2);lctx.fill();
    for(let j=0;j<ladder.length-1;j++){
      for(let bar of ladder[j].bars){
        if(Math.abs(y-bar.y)<3){if(x===ladder[j].x)x=ladder[j+1].x; else if(x===ladder[j+1].x)x=ladder[j].x;}
      }
    }
    y+=2;
    if(y<lcanvas.height-20){requestAnimationFrame(step);} else{
      const finalIndex=ladder.findIndex(l=>l.x===x); done(finalIndex+1);
    }
  }
  step();
}
function showLadderResult(results){
  results.sort((a,b)=>a.pos-b.pos);
  let html="<h2>ğŸ‰ ì‚¬ë‹¤ë¦¬ ê²°ê³¼</h2>";
  results.forEach(r=>{html+=`${r.pos}ë²ˆ â†’ ${r.name}<br>`;});
  document.getElementById("ladderResult").innerHTML=html;
}
</script>
</body>
</html>
